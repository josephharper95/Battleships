function initialise(){if(boardSize=mission.boardSize,null!=mission)switch(mission.name){case"fog-of-war":initFogOfWar();break;case"hardcore":initHardcore();break;case"last-stand":initLastStand();break;case"against-the-clock":initAgainstTheClock();break;case"pearl-harbour":initPearlHarbour();break;case"island-warfare":initIslandWarfare()}}function initLastStand(){playerShipDetails=[{name:"Destroyer",size:2}]}function initHardcore(){$(".perksCont").remove(),$("#opponentContainer .shipsRemainingCont").remove(),$.getScript("../../Scripts/Overrides/playerFireAtComputer.min.js")}function initFogOfWar(){$("#opponentContainer .shipsRemainingCont").remove(),$.getScript("../../Scripts/Overrides/playerFireAtComputer.min.js")}function initAgainstTheClock(){$.getScript("../../Scripts/Overrides/againstTheClock.min.js")}function initPearlHarbour(){opponentShipDetails=[{name:"Destroyer",size:2},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"BattleShip",size:4},{name:"Carrier",size:5},{name:"Fighter-1",size:1},{name:"Fighter-2",size:1},{name:"Fighter-3",size:1},{name:"Fighter-4",size:1}],$(opponentContainer+" .shipsRemainingCont").addClass("pearlHarbour")}function initIslandWarfare(){$(playerContainer+" .mapCont .map").addClass("island");var e=[{x:8,y:3},{x:9,y:3},{x:10,y:3},{x:6,y:4},{x:7,y:4},{x:8,y:4},{x:9,y:4},{x:10,y:4},{x:6,y:5},{x:7,y:5},{x:8,y:5},{x:9,y:5},{x:10,y:5},{x:11,y:5},{x:7,y:6},{x:8,y:6},{x:9,y:6},{x:10,y:6},{x:11,y:6},{x:12,y:6},{x:7,y:7},{x:8,y:7},{x:10,y:7},{x:11,y:7},{x:12,y:7},{x:11,y:8},{x:12,y:8},{x:13,y:8}];$("#acceptMission").unbind("click").one("click",function(){$("#intro").fadeOut(500).promise().done(function(){$("#introOverlay").fadeOut(200),populateShips(),initPlaceShips(),difficulty=mission.difficulty.toLowerCase(),game=new Game(mission.boardSize,e),playerBoardClass=game.getPlayerBoard(),opponentBoardClass=game.getComputerBoard()})})}function runIntro(){runText(),runButtons()}function runText(){mission.text+="<br/><br/>Do you accept this mission?";var e=mission.text.split(""),a="",n=0,t=setInterval(function(){n>=e.length-1&&clearInterval(t),a+=e[n],$("#intro #message p").html(a),n++},50)}function runButtons(){$("#acceptMission").unbind("click").one("click",function(){$("#intro").fadeOut(500).promise().done(function(){$("#introOverlay").fadeOut(200),populateShips(),initPlaceShips(),null==difficulty&&(difficulty=mission.difficulty.toLowerCase()),game=new Game(mission.boardSize),playerBoardClass=game.getPlayerBoard(),opponentBoardClass=game.getComputerBoard()})})}function populateShips(){for(var e="",a=0;a<playerShipDetails.length;a++)shipsToPlace.push(new Ship(playerShipDetails[a].name,playerShipDetails[a].size)),e+="<li class='"+playerShipDetails[a].name+"'></li>";$("#playerContainer "+boardExtras+" ul.remainingShips").html(e),e="";for(var a=0;a<opponentShipDetails.length;a++)e+="<li class='"+opponentShipDetails[a].name+"'></li>";$("#opponentContainer "+boardExtras+" ul.remainingShips").html(e)}function shipsPlaced(){removeHovers(),$(window).unbind("keydown"),setTimeout(function(){$(startGameButton).fadeIn(500)},200),$(startGameButton).unbind("click").one("click",function(){$(startGameButton).fadeOut(500),startGame()})}function startGame(){window.onbeforeunload=confirmExit,gameStarted=!0,$(resetBoardButton).fadeOut(500).unbind("click"),$(undoLastShipButton).fadeOut(500).unbind("click"),$(boardExtras).fadeIn(500),placeAIShips(),startGameExtra(),updatePerks(),playerMove()}function confirmExit(){return"If you leave the page, your game will not be saved"}function endGame(e,a){if(a=endGameExtra(e,a))if(removeClicks(),removeHovers(),disablePerks(),runOutro(e),"player"==e){if(null!=mission){var n;switch(mission.name){case"fog-of-war":n=13;break;case"hardcore":n=14;break;case"last-stand":n=15;break;case"against-the-clock":n=16;break;case"pearl-harbour":n=17;break;case"island-warfare":n=18}$.ajax({url:"../../Content/Ajax/medalAjax.php",data:{action:"unlockMedal",medalId:n},type:"post"})}}else showOpponentShips();window.onbeforeunload=null}function runOutro(e){$("#intro #message p").html(""),$("#introButtons").hide(),$("#outroButtons").show(),$("#introOverlay").fadeIn(200).promise().done(function(){$("#intro").fadeIn(500).promise().done(function(){var a="player"==e?"You Won! <br/><br/> Insert motivational speech about how well you did":"You Lost! <br/><br/> Insert motivational speech about how to get better",n=a.split(""),t="",o=0,r=setInterval(function(){o>=n.length-1&&clearInterval(r),t+=n[o],$("#intro #message p").html(t),o++},50)})})}function updatePerks(){var e=game.getPlayerPerksAvailable(),a="";$.each(e,function(e,n){var t=e.split("_");t=t.join(" "),a+="<li>",a+="<button ",a+="class='button perk' ",a+="data-perk='"+e+"' ",n.usesLeft<=0&&(a+="disabled ",n.usesLeft=0),a+=">",a+=t,a+=" "+n.usesLeft,a+="</button>",a+="</li>"}),$("#playerContainer .perks").html(a),$("#playerContainer .perk:not(:disabled)").off("click").one("click",function(){var e=$(this),a=$(e).data("perk");runPlayerPerk(a)})}function disablePerks(){$("#playerContainer .perk").attr("disabled","disabled")}function runPlayerPerk(e){switch(disablePerks(),e){case"Sonar":initSonarPerk();break;case"Bounce_Bomb":initBounceBombPerk();break;case"Mortar":initMortarPerk()}}function endPlayerPerk(e,a){game.updatePlayerPerks(a);updatePerks(),e?AIMove():playerMove()}function bounceBombAction(e,a,n){var t=new BouncingBomb(opponentBoardClass),o=t.action(e,a,n);boardFireAtOpponentCoordinate(e,a),2==o&&(1==n?boardFireAtOpponentCoordinate(e,a-1):boardFireAtOpponentCoordinate(e+1,a)),removeHovers(),endPlayerPerk(!0,"Bounce_Bomb")}function sonarAction(e,a){var n=new Sonar(opponentBoardClass),t=n.action(e,a);t?$(page+" "+opponentBoard+" tr:eq("+t.getY()+") > td:eq("+t.getX()+")").addClass("sonarShipLocation"):showMessageTimeout("No moves found! Better luck next time...",2e3),endPlayerPerk(!0,"Sonar")}function mortarAction(e,a){var n=new Mortar(opponentBoardClass),t=n.action(e,a);if(t&&3==t.length)for(var o=0;o<t.length;o++)boardFireAtOpponentCoordinate(t[o].getX(),t[o].getY());removeHovers(),endPlayerPerk(!0,"Mortar")}function showOpponentShips(){for(var e=opponentBoardClass.getFloatingShips(),a=0;a<e.length;a++)setShipAttributesOnBoard(opponentBoard,e[a])}function startGameExtra(){}function endGameExtra(e,a){return a}var page="#pageMission",playerContainer="#playerContainer",playerBoard="#playerBoard",opponentBoard="#computerBoard",opponentContainer="#opponentContainer",startGameButton="#startGame",rotateShipButton="#rotateShip",undoLastShipButton="#undoLastShip",resetBoardButton="#resetBoard",boardExtras=".boardExtras",scoreModalOverlay="#scoreModalOverlay",scoreModal="#scoreModal",scoreModalTitle=scoreModal+" #resultTitle",game,gameStarted=!1,playerBoardClass,opponentBoardClass,AI,difficulty,boardSize,shipsToPlace=new Array,totalShots=0,totalHits=0,totalHitsReceived=0,opponentShipDetails=[{name:"Destroyer",size:2},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"BattleShip",size:4},{name:"Carrier",size:5}],playerShipDetails=[{name:"Destroyer",size:2},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"BattleShip",size:4},{name:"Carrier",size:5}];$(document).ready(function(){runIntro(),initialise()});
function populateShips(){var e="";for(i=0;i<shipDetails.length;i++)shipsToPlace.push(new Ship(shipDetails[i].name,shipDetails[i].size)),e+="<li class='"+shipDetails[i].name+"'></li>";$(boardExtras+" ul.remainingShips").html(e)}function updatePerks(){var e=game.getPlayerPerksAvailable(),t="";$.each(e,function(e,a){var o=e.split("_");o=o.join(" "),t+="<li>",t+="<button ",t+="class='button perk' ",t+="data-perk='"+e+"' ",a.usesLeft<=0&&(t+="disabled ",a.usesLeft=0),t+=">",t+=o,t+=" "+a.usesLeft,t+="</button>",t+="</li>"}),$("#playerContainer .perks").html(t),$("#playerContainer .perk:not(:disabled)").off("click").one("click",function(){var e=$(this),t=$(e).data("perk");runPlayerPerk(t)})}function disablePerks(){$("#playerContainer .perk").attr("disabled","disabled")}function runPlayerPerk(e){switch(disablePerks(),e){case"Sonar":initSonarPerk();break;case"Bounce_Bomb":initBounceBombPerk();break;case"Mortar":initMortarPerk()}}function endPlayerPerk(e,t){game.updatePlayerPerks(t);updatePerks(),e?AIMove():playerMove()}function bounceBombAction(e,t,a){var o=new BouncingBomb(opponentBoardClass),n=o.action(e,t,a);boardFireAtOpponentCoordinate(e,t),2==n&&(1==a?boardFireAtOpponentCoordinate(e,t-1):boardFireAtOpponentCoordinate(e+1,t)),removeHovers(),endPlayerPerk(!0,"Bounce_Bomb")}function sonarAction(e,t){var a=new Sonar(opponentBoardClass),o=a.action(e,t);o?$(page+" "+opponentBoard+" tr:eq("+o.getY()+") > td:eq("+o.getX()+")").addClass("sonarShipLocation"):showMessageTimeout("No moves found! Better luck next time...",2e3),endPlayerPerk(!0,"Sonar")}function mortarAction(e,t){var a=new Mortar(opponentBoardClass),o=a.action(e,t);if(o&&3==o.length)for(var n=0;n<o.length;n++)boardFireAtOpponentCoordinate(o[n].getX(),o[n].getY());removeHovers(),endPlayerPerk(!0,"Mortar")}function shipsPlaced(){removeHovers(),$(window).unbind("keydown"),setTimeout(function(){$(startGameButton).fadeIn(500)},200),$(startGameButton).unbind("click").one("click",function(){$(startGameButton).fadeOut(500),startGame()})}function startGame(){window.onbeforeunload=confirmExit,$.ajax({url:"../../Content/Ajax/gameAjax.php",data:{action:"incrementIncompleteGames"},type:"post"}),gameStarted=!0,$(resetBoardButton).fadeOut(500).unbind("click"),$(undoLastShipButton).fadeOut(500).unbind("click"),$(boardExtras).fadeIn(500),placeAIShips(),updatePerks(),playerMove()}function confirmExit(){return"If you leave the page, your game will not be saved"}function endGame(e,t){if(t){removeClicks(),removeHovers(),disablePerks();var a=new Date,o=(a.getTime()-startTime.getTime())/1e3,n=.75;switch(difficulty){case"medium":n=1;break;case"hard":n=1.25}var r=0;switch(boardSize){case 15:r=100;break;case 20:r=200}var i=100,s=5,l=1,d=5,c="player"==e?100:0,p=2,u=totalShots-totalHits,m=totalHits/totalShots*100,f=0;if(o<120)var f=(120-o)*p;var h=totalHitsReceived*s,v=u*l,b=totalHits*d,y=(i-h-v+b+f+c)*n+r;showScore(y,h,v,b,f,c,n,r),"player"==e?$.ajax({url:"../../Content/Ajax/gameAjax.php",data:{action:"recordWin"},type:"post"}):showOpponentShips()}$.ajax({url:"../../Content/Ajax/gameAjax.php",data:{action:"recordShots",totalHits:totalHits,totalHitsReceived:totalHitsReceived,totalShots:totalShots,playingTime:o,gameScore:y},type:"post"}),$.ajax({url:"../../Content/Ajax/medalAjax.php",data:{action:"checkMedalConditions",difficulty:difficulty,winner:e,boardSize:boardSize,accuracy:m,numberOfHits:totalHitsReceived},type:"post"}),window.onbeforeunload=null}function showOpponentShips(){for(var e=opponentBoardClass.getFloatingShips(),t=0;t<e.length;t++)setShipAttributesOnBoard(opponentBoard,e[t])}function showScore(e,t,a,o,n,r,i,s){var l=0!=r;$(scoreModal+" span").hide(),$(scoreModalTitle).html(l?"You Won!":"You Lost!"),$(scoreModalOverlay).fadeIn(200,function(){$(scoreModal).fadeIn(500),$("#baseScore span").fadeIn(500)}),setTimeout(function(){var e=t<0?"":"- ";$(scoreModal+" #hitsReceived span").html(e+t+"pts").fadeIn(500)},500),setTimeout(function(){var e=a<0?"":"- ";$(scoreModal+" #shotsMissed span").html(e+a+"pts").fadeIn(500)},1e3),setTimeout(function(){var e=o<0?"":"+ ";$(scoreModal+" #shotsHit span").html(e+o+"pts").fadeIn(500)},1500),setTimeout(function(){var e=n.toFixed(2)<0?"":"+ ";$(scoreModal+" #timeBonus span").html(e+n.toFixed(2)+"pts").fadeIn(500)},2e3),setTimeout(function(){var e=r<0?"":"+ ";$(scoreModal+" #winBonus span").html(e+r+"pts").fadeIn(500)},2500),setTimeout(function(){$(scoreModal+" #difficultyMultiplier span").html("x "+i).fadeIn(500)},3e3),setTimeout(function(){var e=s<0?"":"+ ";$(scoreModal+" #boardSizeBonus span").html(e+s).fadeIn(500)},3500),setTimeout(function(){$(scoreModal+" #total span").html(e.toFixed(2)+"pts").fadeIn(500)},4e3),$("#closeModal").off("click").one("click",function(){$(scoreModalOverlay).fadeOut(200),$(scoreModal).fadeOut(500)})}var page="#pageSinglePlayer",playerBoard="#playerBoard",opponentBoard="#computerBoard",startGameButton="#startGame",rotateShipButton="#rotateShip",undoLastShipButton="#undoLastShip",resetBoardButton="#resetBoard",boardExtras=".boardExtras",scoreModalOverlay="#scoreModalOverlay",scoreModal="#scoreModal",scoreModalTitle=scoreModal+" #resultTitle",game,gameStarted=!1,playerBoardClass,opponentBoardClass,AI,difficulty,boardSize,totalShots=0,totalHits=0,totalHitsReceived=0,startTime=new Date,shipDetails=[{name:"Destroyer",size:2},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"BattleShip",size:4},{name:"Carrier",size:5}],shipsToPlace=new Array;$(document).ready(function(){populateShips(),initPlaceShips(),boardSize=$(page+" "+playerBoard+" tr").length,difficulty=$("#opponentContainer").data("difficulty"),game=new Game(boardSize),playerBoardClass=game.getPlayerBoard(),opponentBoardClass=game.getComputerBoard()});